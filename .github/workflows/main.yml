الاسم: RDPعلى:  سير العمل_الإرسال:الوظائف:  secure-rdp:    يعمل على: أحدث إصدار من Windows    دقائق المهلة: 3600    خطوات:      - الاسم: تكوين إعدادات Core RDP        تشغيل: |          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "SecurityLayer" -Value 0 -Force          netsh advfirewall firewall حذف القاعدة name="RDP-Tailscale"          netsh advfirewall firewall إضافة قاعدة اسم="RDP-Tailscale" dir=في الإجراء=السماح بالبروتوكول=TCP localport=3389          إعادة تشغيل الخدمة - اسم TermService - فرض
      - الاسم: إنشاء مستخدم RDP بكلمة مرور ثابتة        تشغيل: |          $password = "admin@123"          $securePass = ConvertTo-SecureString $password -AsPlainText -Force
          إذا (-لا (Get-LocalUser -Name "TOOLBOXLAP" -ErrorAction استمر بصمت)) {              مستخدم محلي جديد - الاسم "TOOLBOXLAP" - كلمة المرور $securePass - الحساب لا ينتهي أبدًا          }
          إضافة عضو المجموعة المحلية - المجموعة "المسؤولون" - العضو "TOOLBOXLAP"          إضافة عضو المجموعة المحلية - مجموعة "مستخدمي سطح المكتب البعيد" - عضو "TOOLBOXLAP"
          صدى "RDP_CREDS=المستخدم: TOOLBOXLAP | كلمة المرور: $password" >> $env:GITHUB_ENV
          إذا (-لا (Get-LocalUser -Name "TOOLBOXLAP")) {              خطأ الكتابة "فشل إنشاء المستخدم"              مخرج 1          }
      - الاسم: تثبيت Tailscale        تشغيل: |          $tsUrl = "https://pkgs.tailscale.com/stable/tailscale-setup-1.82.0-amd64.msi"          $installerPath = "$env:TEMP\tailscale.msi"
          استدعاء طلب الويب -Uri $tsUrl -OutFile $installerPath          بدء عملية msiexec.exe - قائمة الحجج "/i"، "`"$installerPath`""، "/quiet"، "/norestart" - الانتظار          إزالة العنصر $installerPath -Force
      - الاسم: إنشاء اتصال Tailscale        تشغيل: |          & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=gh-runner-$env:GITHUB_RUN_ID          $tsIP = $null          $retries = 0          بينما (-ليس $tsIP -و $retries -lt 10) {              $tsIP = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4              البدء - النوم - 5 ثوانٍ              $إعادة المحاولة++          }          إذا (-ليس $tsIP) {              خطأ الكتابة "لم يتم تعيين عنوان IP الخاص بـ Tailscale. الخروج."              مخرج 1          }          صدى "TAILSCALE_IP=$tsIP" >> $env:GITHUB_ENV
      - الاسم: التحقق من إمكانية الوصول إلى RDP        تشغيل: |          كتابة المضيف "Tailscale IP: $env:TAILSCALE_IP"          $testResult = Test-NetConnection -ComputerName $env:TAILSCALE_IP -Port 3389          إذا (-ليس $testResult.TcpTestSucceeded) {              خطأ الكتابة "فشل اتصال TCP بمنفذ RDP 3389"              مخرج 1          }          كتابة المضيف "اتصال TCP ناجح!"
      - الاسم: الحفاظ على الاتصال        تشغيل: |          كتابة المضيف "`n=== RDP ACCESS ==="          كتابة المضيف "العنوان: $env:TAILSCALE_IP"          كتابة المضيف "اسم المستخدم: TOOLBOXLAP"          Write-Host "كلمة المرور: admin@123"          كتابة المضيف "==================`n"          بينما ($true) {              Write-Host "[$(Get-Date)] RDP نشط - استخدم Ctrl+C في سير العمل لإنهاء العمل"              بدء النوم - 300 ثانية          }
